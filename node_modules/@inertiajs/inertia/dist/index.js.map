{"version":3,"file":"index.js","sources":["../src/modal.ts","../src/types.ts","../src/debounce.ts","../src/formData.ts","../src/url.ts","../src/events.ts","../src/router.ts","../src/files.ts","../src/head.ts","../src/index.ts","../src/shouldIntercept.ts"],"sourcesContent":["export default {\n  modal: null,\n  listener: null,\n\n  show(html: Record<string, unknown>|string): void {\n    if (typeof html === 'object') {\n      html = `All Inertia requests must receive a valid Inertia response, however a plain JSON response was received.<hr>${JSON.stringify(html)}`\n    }\n\n    const page = document.createElement('html')\n    page.innerHTML = html\n    page.querySelectorAll('a').forEach(a => a.setAttribute('target', '_top'))\n\n    this.modal = document.createElement('div')\n    this.modal.style.position = 'fixed'\n    this.modal.style.width = '100vw'\n    this.modal.style.height = '100vh'\n    this.modal.style.padding = '50px'\n    this.modal.style.boxSizing = 'border-box'\n    this.modal.style.backgroundColor = 'rgba(0, 0, 0, .6)'\n    this.modal.style.zIndex = 200000\n    this.modal.addEventListener('click', () => this.hide())\n\n    const iframe = document.createElement('iframe')\n    iframe.style.backgroundColor = 'white'\n    iframe.style.borderRadius = '5px'\n    iframe.style.width = '100%'\n    iframe.style.height = '100%'\n    this.modal.appendChild(iframe)\n\n    document.body.prepend(this.modal)\n    document.body.style.overflow = 'hidden'\n    if (!iframe.contentWindow) {\n      throw new Error('iframe not yet ready.')\n    }\n    iframe.contentWindow.document.open()\n    iframe.contentWindow.document.write(page.outerHTML)\n    iframe.contentWindow.document.close()\n\n    this.listener = this.hideOnEscape.bind(this)\n    document.addEventListener('keydown', this.listener)\n  },\n\n  hide(): void {\n    this.modal.outerHTML = ''\n    this.modal = null\n    document.body.style.overflow = 'visible'\n    document.removeEventListener('keydown', this.listener)\n  },\n\n  hideOnEscape(event: KeyboardEvent): void {\n    if (event.keyCode === 27) {\n      this.hide()\n    }\n  },\n}\n","import { AxiosResponse, CancelTokenSource } from 'axios'\n\nexport type Errors = Record<string, string>\nexport type ErrorBag = Record<string, Errors>\n\nexport type FormDataConvertible = Array<FormDataConvertible>|Blob|FormDataEntryValue|Date|boolean|number|null\n\nexport enum Method {\n  GET = 'get',\n  POST = 'post',\n  PUT = 'put',\n  PATCH = 'patch',\n  DELETE = 'delete',\n}\n\nexport type RequestPayload = Record<string, FormDataConvertible>|FormData\n\nexport interface PageProps {\n  [key: string]: unknown\n}\n\nexport interface Page<SharedProps = PageProps> {\n  component: string,\n  props: PageProps & SharedProps & {\n    errors: Errors & ErrorBag;\n  }\n  url: string,\n  version: string|null\n\n  // Refactor away\n  scrollRegions: Array<{ top: number, left: number }>\n  rememberedState: Record<string, unknown>\n  resolvedErrors: Errors\n}\n\nexport type PageResolver = (name: string) => Component\n\nexport type PageHandler = ({\n  component,\n  page,\n  preserveState,\n}: {\n  component: Component,\n  page: Page,\n  preserveState: PreserveStateOption,\n}) => Promise<unknown>\n\nexport type PreserveStateOption = boolean|string|((page: Page) => boolean)\n\nexport type Progress = ProgressEvent & { percentage: number }\n\nexport type LocationVisit = {\n  preserveScroll: boolean,\n}\n\nexport type Visit = {\n  method: Method,\n  data: RequestPayload,\n  replace: boolean,\n  preserveScroll: PreserveStateOption,\n  preserveState: PreserveStateOption,\n  only: Array<string>,\n  headers: Record<string, string>\n  errorBag: string|null,\n  forceFormData: boolean,\n  queryStringArrayFormat: 'indices'|'brackets',\n}\n\nexport type GlobalEventsMap = {\n  before: {\n    parameters: [PendingVisit],\n    details: {\n      visit: PendingVisit,\n    },\n    result: boolean|void,\n  },\n  start: {\n    parameters: [PendingVisit],\n    details: {\n      visit: PendingVisit,\n    },\n    result: void,\n  },\n  progress: {\n    parameters: [Progress|undefined],\n    details: {\n      progress: Progress|undefined,\n    },\n    result: void,\n  },\n  finish: {\n    parameters: [ActiveVisit],\n    details: {\n      visit: ActiveVisit,\n    },\n    result: void,\n  },\n  cancel: {\n    parameters: [],\n    details: {\n    },\n    result: void,\n  },\n  navigate: {\n    parameters: [Page],\n    details: {\n        page: Page\n    },\n    result: void,\n  },\n  success: {\n    parameters: [Page],\n    details: {\n        page: Page\n    },\n    result: void,\n  },\n  error: {\n    parameters: [Errors],\n    details: {\n        errors: Errors\n    },\n    result: void,\n  },\n  invalid: {\n    parameters: [AxiosResponse],\n    details: {\n        response: AxiosResponse\n    },\n    result: boolean|void,\n  },\n  exception: {\n    parameters: [Error],\n    details: {\n        exception: Error\n    },\n    result: boolean|void,\n  },\n}\n\nexport type GlobalEventNames = keyof GlobalEventsMap\n\nexport type GlobalEvent<TEventName extends GlobalEventNames> = CustomEvent<GlobalEventDetails<TEventName>>\n\nexport type GlobalEventParameters<TEventName extends GlobalEventNames> = GlobalEventsMap[TEventName]['parameters']\n\nexport type GlobalEventResult<TEventName extends GlobalEventNames> = GlobalEventsMap[TEventName]['result']\n\nexport type GlobalEventDetails<TEventName extends GlobalEventNames> = GlobalEventsMap[TEventName]['details']\n\nexport type GlobalEventTrigger<TEventName extends GlobalEventNames> = (...params: GlobalEventParameters<TEventName>) => GlobalEventResult<TEventName>\n\nexport type GlobalEventCallback<TEventName extends GlobalEventNames> = (...params: GlobalEventParameters<TEventName>) => GlobalEventResult<TEventName>\n\nexport type VisitOptions = Partial<Visit & {\n  onCancelToken: { ({ cancel }: { cancel: VoidFunction }): void },\n  onBefore: GlobalEventCallback<'before'>,\n  onStart: GlobalEventCallback<'start'>,\n  onProgress: GlobalEventCallback<'progress'>,\n  onFinish: GlobalEventCallback<'finish'>,\n  onCancel: GlobalEventCallback<'cancel'>,\n  onSuccess: GlobalEventCallback<'success'>,\n  onError: GlobalEventCallback<'error'>,\n}>\n\nexport type PendingVisit = Visit & {\n  url: URL,\n  completed: boolean,\n  cancelled: boolean,\n  interrupted: boolean,\n};\n\nexport type ActiveVisit = PendingVisit & Required<VisitOptions> & {\n  cancelToken: CancelTokenSource,\n}\n\nexport type VisitId = unknown\nexport type Component = unknown\n\nexport type InertiaAppResponse = Promise<{ head: string[], body: string } | void>\n","// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport default function debounce<F extends (...params: any[]) => ReturnType<F>>(fn: F, delay: number): F {\n  let timeoutID: NodeJS.Timeout\n  return function (...args: unknown[]) {\n    clearTimeout(timeoutID)\n    timeoutID = setTimeout(() => fn.apply(this, args), delay)\n  } as F\n}\n","import { FormDataConvertible } from './types'\n\nexport function objectToFormData(\n  source: Record<string, FormDataConvertible>,\n  form: FormData = new FormData(),\n  parentKey: string|null = null,\n): FormData {\n  source = source || {}\n\n  for (const key in source) {\n    if (Object.prototype.hasOwnProperty.call(source, key)) {\n      append(form, composeKey(parentKey, key), source[key])\n    }\n  }\n\n  return form\n}\n\nfunction composeKey(parent: string|null, key: string): string {\n  return parent ? parent + '[' + key + ']' : key\n}\n\nfunction append(form: FormData, key: string, value: FormDataConvertible): void {\n  if (Array.isArray(value)) {\n    return Array.from(value.keys()).forEach(index => append(form, composeKey(key, index.toString()), value[index]))\n  } else if (value instanceof Date) {\n    return form.append(key, value.toISOString())\n  } else if (value instanceof File) {\n    return form.append(key, value, value.name)\n  } else if (value instanceof Blob) {\n    return form.append(key, value)\n  } else if (typeof value === 'boolean') {\n    return form.append(key, value ? '1' : '0')\n  } else if (typeof value === 'string') {\n    return form.append(key, value)\n  } else if (typeof value === 'number') {\n    return form.append(key, `${value}`)\n  } else if (value === null || value === undefined) {\n    return form.append(key, '')\n  }\n\n  objectToFormData(value, form, key)\n}\n","import * as qs from 'qs'\nimport deepmerge from 'deepmerge'\nimport { FormDataConvertible, Method } from './types'\n\nexport function hrefToUrl(href: string|URL): URL {\n  return new URL(href.toString(), window.location.toString())\n}\n\nexport function mergeDataIntoQueryString(\n  method: Method,\n  href: URL|string,\n  data: Record<string, FormDataConvertible>,\n  qsArrayFormat: 'indices'|'brackets' = 'brackets',\n): [string, Record<string, FormDataConvertible>] {\n  const hasHost = /^https?:\\/\\//.test(href.toString())\n  const hasAbsolutePath = hasHost || href.toString().startsWith('/')\n  const hasRelativePath = !hasAbsolutePath && !href.toString().startsWith('#') && !href.toString().startsWith('?')\n  const hasSearch = href.toString().includes('?') || (method === Method.GET && Object.keys(data).length)\n  const hasHash = href.toString().includes('#')\n\n  const url = new URL(href.toString(), 'http://localhost')\n\n  if (method === Method.GET && Object.keys(data).length) {\n    url.search = qs.stringify(deepmerge(qs.parse(url.search, { ignoreQueryPrefix: true }), data), {\n      encodeValuesOnly: true,\n      arrayFormat: qsArrayFormat,\n    })\n    data = {}\n  }\n\n  return [\n    [\n      hasHost ? `${url.protocol}//${url.host}` : '',\n      hasAbsolutePath ? url.pathname : '',\n      hasRelativePath ? url.pathname.substring(1) : '',\n      hasSearch ? url.search : '',\n      hasHash ? url.hash : '',\n    ].join(''),\n    data,\n  ]\n}\n\nexport function urlWithoutHash(url: URL|Location): URL {\n  url = new URL(url.href)\n  url.hash = ''\n  return url\n}\n","import { GlobalEventDetails, GlobalEventNames, GlobalEventTrigger } from './types'\n\nfunction fireEvent<TEventName extends GlobalEventNames>(name: TEventName, options: CustomEventInit<GlobalEventDetails<TEventName>>): boolean {\n  return document.dispatchEvent(new CustomEvent(`inertia:${name}`, options))\n}\n\nexport const fireBeforeEvent: GlobalEventTrigger<'before'> = (visit) => {\n  return fireEvent('before', { cancelable: true, detail: { visit } })\n}\n\nexport const fireErrorEvent: GlobalEventTrigger<'error'> = (errors) => {\n  return fireEvent('error', { detail: { errors } })\n}\n\nexport const fireExceptionEvent: GlobalEventTrigger<'exception'> = (exception) => {\n  return fireEvent('exception', { cancelable: true, detail: { exception } })\n}\n\nexport const fireFinishEvent: GlobalEventTrigger<'finish'> = (visit) => {\n  return fireEvent('finish', { detail: { visit } })\n}\n\nexport const fireInvalidEvent: GlobalEventTrigger<'invalid'> = (response) => {\n  return fireEvent('invalid', { cancelable: true, detail: { response } })\n}\n\nexport const fireNavigateEvent: GlobalEventTrigger<'navigate'> = (page) => {\n  return fireEvent('navigate', { detail: { page } })\n}\n\nexport const fireProgressEvent: GlobalEventTrigger<'progress'> = (progress) => {\n  return fireEvent('progress', { detail: { progress } })\n}\n\nexport const fireStartEvent: GlobalEventTrigger<'start'> = (visit) => {\n  return fireEvent('start', { detail: { visit } })\n}\n\nexport const fireSuccessEvent: GlobalEventTrigger<'success'> = (page) => {\n  return fireEvent('success', { detail: { page } })\n}\n","import modal from './modal'\nimport debounce from './debounce'\nimport { hasFiles } from './files'\nimport { objectToFormData } from './formData'\nimport { default as Axios, AxiosResponse } from 'axios'\nimport { hrefToUrl, mergeDataIntoQueryString, urlWithoutHash } from './url'\nimport { ActiveVisit, GlobalEvent, GlobalEventNames, GlobalEventResult, LocationVisit, Method, Page, PageHandler, PageResolver, PendingVisit, PreserveStateOption, RequestPayload, VisitId, VisitOptions } from './types'\nimport { fireBeforeEvent, fireErrorEvent, fireExceptionEvent, fireFinishEvent, fireInvalidEvent, fireNavigateEvent, fireProgressEvent, fireStartEvent, fireSuccessEvent } from './events'\n\nconst isServer = typeof window === 'undefined'\n\nexport class Router {\n  protected resolveComponent!: PageResolver\n  protected swapComponent!: PageHandler\n  protected activeVisit?: ActiveVisit\n  protected visitId: VisitId = null\n  protected page!: Page\n\n  public init({\n    initialPage,\n    resolveComponent,\n    swapComponent,\n  }: {\n    initialPage: Page,\n    resolveComponent: PageResolver,\n    swapComponent: PageHandler,\n  }): void {\n    this.page = initialPage\n    this.resolveComponent = resolveComponent\n    this.swapComponent = swapComponent\n\n    if (this.isBackForwardVisit()) {\n      this.handleBackForwardVisit(this.page)\n    } else if (this.isLocationVisit()) {\n      this.handleLocationVisit(this.page)\n    } else {\n      this.handleInitialPageVisit(this.page)\n    }\n\n    this.setupEventListeners()\n  }\n\n  protected handleInitialPageVisit(page: Page): void {\n    this.page.url += window.location.hash\n    this.setPage(page, { preserveState: true }).then(() => fireNavigateEvent(page))\n  }\n\n  protected setupEventListeners(): void {\n    window.addEventListener('popstate', this.handlePopstateEvent.bind(this))\n    document.addEventListener('scroll', debounce(this.handleScrollEvent.bind(this), 100), true)\n  }\n\n  protected scrollRegions(): NodeListOf<Element> {\n    return document.querySelectorAll('[scroll-region]')\n  }\n\n  protected handleScrollEvent(event: Event): void {\n    if (typeof (event.target as Element).hasAttribute === 'function' && (event.target as Element).hasAttribute('scroll-region')) {\n      this.saveScrollPositions()\n    }\n  }\n\n  protected saveScrollPositions(): void {\n    this.replaceState({\n      ...this.page,\n      scrollRegions: Array.from(this.scrollRegions()).map(region => {\n        return {\n          top: region.scrollTop,\n          left: region.scrollLeft,\n        }\n      }),\n    })\n  }\n\n  protected resetScrollPositions(): void {\n    window.scrollTo(0, 0)\n    this.scrollRegions().forEach(region => {\n      if (typeof region.scrollTo === 'function') {\n        region.scrollTo(0, 0)\n      } else {\n        region.scrollTop = 0\n        region.scrollLeft = 0\n      }\n    })\n    this.saveScrollPositions()\n    if (window.location.hash) {\n      document.getElementById(window.location.hash.slice(1))?.scrollIntoView()\n    }\n  }\n\n  protected restoreScrollPositions(): void {\n    if (this.page.scrollRegions) {\n      this.scrollRegions().forEach((region: Element, index: number) => {\n        const scrollPosition = this.page.scrollRegions[index]\n        if (! scrollPosition) {\n          return\n        } else if (typeof region.scrollTo === 'function') {\n          region.scrollTo(scrollPosition.left, scrollPosition.top)\n        } else {\n          region.scrollTop = scrollPosition.top\n          region.scrollLeft = scrollPosition.left\n        }\n      })\n    }\n  }\n\n  protected isBackForwardVisit(): boolean {\n    return window.history.state\n        && window.performance\n        && window.performance.getEntriesByType('navigation').length > 0\n        && (window.performance.getEntriesByType('navigation')[0] as PerformanceNavigationTiming).type === 'back_forward'\n  }\n\n  protected handleBackForwardVisit(page: Page): void {\n    window.history.state.version = page.version\n    this.setPage(window.history.state, { preserveScroll: true, preserveState: true }).then(() => {\n      this.restoreScrollPositions()\n      fireNavigateEvent(page)\n    })\n  }\n\n  protected locationVisit(url: URL, preserveScroll: LocationVisit['preserveScroll']): boolean|void {\n    try {\n      const locationVisit: LocationVisit = { preserveScroll }\n      window.sessionStorage.setItem('inertiaLocationVisit', JSON.stringify(locationVisit))\n      window.location.href = url.href\n      if (urlWithoutHash(window.location).href === urlWithoutHash(url).href) {\n        window.location.reload()\n      }\n    } catch (error) {\n      return false\n    }\n  }\n\n  protected isLocationVisit(): boolean {\n    try {\n      return window.sessionStorage.getItem('inertiaLocationVisit') !== null\n    } catch (error) {\n      return false\n    }\n  }\n\n  protected handleLocationVisit(page: Page): void {\n    const locationVisit: LocationVisit = JSON.parse(window.sessionStorage.getItem('inertiaLocationVisit') || '')\n    window.sessionStorage.removeItem('inertiaLocationVisit')\n    page.url += window.location.hash\n    page.rememberedState = window.history.state?.rememberedState ?? {}\n    page.scrollRegions = window.history.state?.scrollRegions ?? []\n    this.setPage(page, { preserveScroll: locationVisit.preserveScroll, preserveState: true }).then(() => {\n      if (locationVisit.preserveScroll) {\n        this.restoreScrollPositions()\n      }\n      fireNavigateEvent(page)\n    })\n  }\n\n  protected isLocationVisitResponse(response: AxiosResponse): boolean {\n    return response && response.status === 409 && response.headers['x-inertia-location']\n  }\n\n  protected isInertiaResponse(response: AxiosResponse): boolean {\n    return response?.headers['x-inertia']\n  }\n\n  protected createVisitId(): VisitId {\n    this.visitId = {}\n    return this.visitId\n  }\n\n  protected cancelVisit(\n    activeVisit: ActiveVisit,\n    { cancelled = false, interrupted = false}: { cancelled?: boolean, interrupted?: boolean },\n  ): void {\n    if (activeVisit && !activeVisit.completed && !activeVisit.cancelled && !activeVisit.interrupted) {\n      activeVisit.cancelToken.cancel()\n      activeVisit.onCancel()\n      activeVisit.completed = false\n      activeVisit.cancelled = cancelled\n      activeVisit.interrupted = interrupted\n      fireFinishEvent(activeVisit)\n      activeVisit.onFinish(activeVisit)\n    }\n  }\n\n  protected finishVisit(visit: ActiveVisit): void {\n    if (!visit.cancelled && !visit.interrupted) {\n      visit.completed = true\n      visit.cancelled = false\n      visit.interrupted = false\n      fireFinishEvent(visit)\n      visit.onFinish(visit)\n    }\n  }\n\n  protected resolvePreserveOption(value: PreserveStateOption, page: Page): boolean|string {\n    if (typeof value === 'function') {\n      return value(page)\n    } else if (value === 'errors') {\n      return Object.keys(page.props.errors || {}).length > 0\n    } else {\n      return value\n    }\n  }\n\n  public visit(href: string|URL, {\n    method = Method.GET,\n    data = {},\n    replace = false,\n    preserveScroll = false,\n    preserveState = false,\n    only = [],\n    headers = {},\n    errorBag = '',\n    forceFormData = false,\n    onCancelToken = () => {},\n    onBefore = () => {},\n    onStart = () => {},\n    onProgress = () => {},\n    onFinish = () => {},\n    onCancel = () => {},\n    onSuccess = () => {},\n    onError = () => {},\n    queryStringArrayFormat = 'brackets',\n  }: VisitOptions = {}): void {\n    let url = typeof href === 'string' ? hrefToUrl(href) : href\n\n    if ((hasFiles(data) || forceFormData) && !(data instanceof FormData)) {\n      data = objectToFormData(data)\n    }\n\n    if (!(data instanceof FormData)) {\n      const [_href, _data] = mergeDataIntoQueryString(method, url, data, queryStringArrayFormat)\n      url = hrefToUrl(_href)\n      data = _data\n    }\n\n    const visit: PendingVisit = {\n      url,\n      method,\n      data,\n      replace,\n      preserveScroll,\n      preserveState,\n      only,\n      headers,\n      errorBag,\n      forceFormData,\n      queryStringArrayFormat,\n      cancelled: false,\n      completed: false,\n      interrupted: false,\n    }\n\n    if (onBefore(visit) === false || !fireBeforeEvent(visit)) {\n      return\n    }\n\n    if (this.activeVisit) {\n      this.cancelVisit(this.activeVisit, { interrupted: true })\n    }\n\n    this.saveScrollPositions()\n\n    const visitId = this.createVisitId()\n    this.activeVisit = { ...visit, onCancelToken, onBefore, onStart, onProgress, onFinish, onCancel, onSuccess, onError, queryStringArrayFormat, cancelToken: Axios.CancelToken.source() }\n\n    onCancelToken({\n      cancel: () => {\n        if (this.activeVisit) {\n          this.cancelVisit(this.activeVisit, { cancelled: true })\n        }\n      },\n    })\n\n    fireStartEvent(visit)\n    onStart(visit)\n\n    Axios({\n      method,\n      url: urlWithoutHash(url).href,\n      data: method === Method.GET ? {} : data,\n      params: method === Method.GET ? data : {},\n      cancelToken: this.activeVisit.cancelToken.token,\n      headers: {\n        ...headers,\n        Accept: 'text/html, application/xhtml+xml',\n        'X-Requested-With': 'XMLHttpRequest',\n        'X-Inertia': true,\n        ...(only.length ? {\n          'X-Inertia-Partial-Component': this.page.component,\n          'X-Inertia-Partial-Data': only.join(','),\n        } : {}),\n        ...(errorBag && errorBag.length ? { 'X-Inertia-Error-Bag': errorBag } : {}),\n        ...(this.page.version ? { 'X-Inertia-Version': this.page.version } : {}),\n      },\n      onUploadProgress: progress => {\n        if (data instanceof FormData) {\n          progress.percentage = Math.round(progress.loaded / progress.total * 100)\n          fireProgressEvent(progress)\n          onProgress(progress)\n        }\n      },\n    }).then(response => {\n      if (!this.isInertiaResponse(response)) {\n        return Promise.reject({ response })\n      }\n\n      const pageResponse: Page = response.data\n      if (only.length && pageResponse.component === this.page.component) {\n        pageResponse.props = { ...this.page.props, ...pageResponse.props }\n      }\n      preserveScroll = this.resolvePreserveOption(preserveScroll, pageResponse) as boolean\n      preserveState = this.resolvePreserveOption(preserveState, pageResponse)\n      if (preserveState && window.history.state?.rememberedState && pageResponse.component === this.page.component) {\n        pageResponse.rememberedState = window.history.state.rememberedState\n      }\n      const requestUrl = url\n      const responseUrl = hrefToUrl(pageResponse.url)\n      if (requestUrl.hash && !responseUrl.hash && urlWithoutHash(requestUrl).href === responseUrl.href) {\n        responseUrl.hash = requestUrl.hash\n        pageResponse.url = responseUrl.href\n      }\n      return this.setPage(pageResponse, { visitId, replace, preserveScroll, preserveState })\n    }).then(() => {\n      const errors = this.page.props.errors || {}\n      if (Object.keys(errors).length > 0) {\n        const scopedErrors = errorBag ? (errors[errorBag] ? errors[errorBag] : {}) : errors\n        fireErrorEvent(scopedErrors)\n        return onError(scopedErrors)\n      }\n      fireSuccessEvent(this.page)\n      return onSuccess(this.page)\n    }).catch(error => {\n      if (this.isInertiaResponse(error.response)) {\n        return this.setPage(error.response.data, { visitId })\n      } else if (this.isLocationVisitResponse(error.response)) {\n        const locationUrl = hrefToUrl(error.response.headers['x-inertia-location'])\n        const requestUrl = url\n        if (requestUrl.hash && !locationUrl.hash && urlWithoutHash(requestUrl).href === locationUrl.href) {\n          locationUrl.hash = requestUrl.hash\n        }\n        this.locationVisit(locationUrl, preserveScroll === true)\n      } else if (error.response) {\n        if (fireInvalidEvent(error.response)) {\n          modal.show(error.response.data)\n        }\n      } else {\n        return Promise.reject(error)\n      }\n    }).then(() => {\n      if (this.activeVisit) {\n        this.finishVisit(this.activeVisit)\n      }\n    }).catch(error => {\n      if (!Axios.isCancel(error)) {\n        const throwException = fireExceptionEvent(error)\n        if (this.activeVisit) {\n          this.finishVisit(this.activeVisit)\n        }\n        if (throwException) {\n          return Promise.reject(error)\n        }\n      }\n    })\n  }\n\n  protected setPage(page: Page, {\n    visitId = this.createVisitId(),\n    replace = false,\n    preserveScroll = false,\n    preserveState = false,\n  }: {\n    visitId?: VisitId,\n    replace?: boolean,\n    preserveScroll?: PreserveStateOption\n    preserveState?: PreserveStateOption\n  } = {}): Promise<void> {\n    return Promise.resolve(this.resolveComponent(page.component)).then(component => {\n      if (visitId === this.visitId) {\n        page.scrollRegions = page.scrollRegions || []\n        page.rememberedState = page.rememberedState || {}\n        replace = replace || hrefToUrl(page.url).href === window.location.href\n        replace ? this.replaceState(page) : this.pushState(page)\n        this.swapComponent({ component, page, preserveState }).then(() => {\n          if (!preserveScroll) {\n            this.resetScrollPositions()\n          }\n          if (!replace) {\n            fireNavigateEvent(page)\n          }\n        })\n      }\n    })\n  }\n\n  protected pushState(page: Page): void {\n    this.page = page\n    window.history.pushState(page, '', page.url)\n  }\n\n  protected replaceState(page: Page): void {\n    this.page = page\n    window.history.replaceState(page, '', page.url)\n  }\n\n  protected handlePopstateEvent(event: PopStateEvent): void {\n    if (event.state !== null) {\n      const page = event.state\n      const visitId = this.createVisitId()\n      Promise.resolve(this.resolveComponent(page.component)).then(component => {\n        if (visitId === this.visitId) {\n          this.page = page\n          this.swapComponent({ component, page, preserveState: false }).then(() => {\n            this.restoreScrollPositions()\n            fireNavigateEvent(page)\n          })\n        }\n      })\n    } else {\n      const url = hrefToUrl(this.page.url)\n      url.hash = window.location.hash\n      this.replaceState({ ...this.page, url: url.href })\n      this.resetScrollPositions()\n    }\n  }\n\n  public get(url: URL|string, data: RequestPayload = {}, options: Exclude<VisitOptions, 'method'|'data'> = {}): void {\n    return this.visit(url, { ...options, method: Method.GET, data })\n  }\n\n  public reload(options: Exclude<VisitOptions, 'preserveScroll'|'preserveState'> = {}): void {\n    return this.visit(window.location.href, { ...options, preserveScroll: true, preserveState: true })\n  }\n\n  public replace(url: URL|string, options: Exclude<VisitOptions, 'replace'> = {}): void {\n    console.warn(`Inertia.replace() has been deprecated and will be removed in a future release. Please use Inertia.${options.method ?? 'get'}() instead.`)\n    return this.visit(url, { preserveState: true, ...options, replace: true })\n  }\n\n  public post(url: URL|string, data: RequestPayload = {}, options: Exclude<VisitOptions, 'method'|'data'> = {}): void {\n    return this.visit(url, { preserveState: true, ...options, method: Method.POST, data })\n  }\n\n  public put(url: URL|string, data: RequestPayload = {}, options: Exclude<VisitOptions, 'method'|'data'> = {}): void {\n    return this.visit(url, { preserveState: true, ...options, method: Method.PUT, data })\n  }\n\n  public patch(url: URL|string, data: RequestPayload = {}, options: Exclude<VisitOptions, 'method'|'data'> = {}): void {\n    return this.visit(url, { preserveState: true, ...options, method: Method.PATCH, data })\n  }\n\n  public delete(url: URL|string, options: Exclude<VisitOptions, 'method'> = {}): void {\n    return this.visit(url, { preserveState: true, ...options, method: Method.DELETE })\n  }\n\n  public remember(data: unknown, key = 'default'): void {\n    if (isServer) {\n      return\n    }\n\n    this.replaceState({\n      ...this.page,\n      rememberedState: {\n        ...this.page?.rememberedState,\n        [key]: data,\n      },\n    })\n  }\n\n  public restore(key = 'default'): unknown {\n    if (isServer) {\n      return\n    }\n\n    return window.history.state?.rememberedState?.[key]\n  }\n\n  public on<TEventName extends GlobalEventNames>(type: TEventName, callback: (event: GlobalEvent<TEventName>) => GlobalEventResult<TEventName>): VoidFunction {\n    const listener = ((event: GlobalEvent<TEventName>) => {\n      const response = callback(event)\n      if (event.cancelable && !event.defaultPrevented && response === false) {\n        event.preventDefault()\n      }\n    }) as EventListener\n\n    document.addEventListener(`inertia:${type}`, listener)\n    return () => document.removeEventListener(`inertia:${type}`, listener)\n  }\n}\n","import { FormDataConvertible, RequestPayload } from './types'\n\nexport function hasFiles(data: RequestPayload|FormDataConvertible): boolean {\n  return (\n    data instanceof File ||\n    data instanceof Blob ||\n    (data instanceof FileList && data.length > 0) ||\n    (data instanceof FormData && Array.from(data.values()).some((value) => hasFiles(value))) ||\n    (typeof data === 'object' && data !== null && Object.values(data).some((value) => hasFiles(value)))\n  )\n}\n","import debounce from './debounce'\n\nconst Renderer = {\n  buildDOMElement(tag: string): ChildNode {\n    const template = document.createElement('template')\n    template.innerHTML = tag\n    const node = (template.content.firstChild as Element)\n\n    if (!tag.startsWith('<script ')) {\n      return node\n    }\n\n    const script = document.createElement('script')\n    script.innerHTML = node.innerHTML\n    node.getAttributeNames().forEach(name => {\n      script.setAttribute(name, node.getAttribute(name) || '')\n    })\n\n    return script\n  },\n\n  isInertiaManagedElement(element: Element): boolean {\n    return element.nodeType === Node.ELEMENT_NODE && element.getAttribute('inertia') !== null\n  },\n\n  findMatchingElementIndex(element: Element, elements: Array<Element>): number {\n    const key = element.getAttribute('inertia')\n    if (key !== null) {\n      return elements.findIndex(element => element.getAttribute('inertia') === key)\n    }\n\n    return -1\n  },\n\n  update: debounce(function (elements: Array<string>) {\n    const sourceElements = elements.map(element => this.buildDOMElement(element))\n    const targetElements = Array.from(document.head.childNodes).filter(element => this.isInertiaManagedElement(element as Element))\n\n    targetElements.forEach(targetElement => {\n      const index = this.findMatchingElementIndex((targetElement as Element), sourceElements)\n      if (index === -1) {\n        targetElement?.parentNode?.removeChild(targetElement)\n        return\n      }\n\n      const sourceElement = sourceElements.splice(index, 1)[0]\n      if (sourceElement && !targetElement.isEqualNode(sourceElement)) {\n        targetElement?.parentNode?.replaceChild(sourceElement, targetElement)\n      }\n    })\n\n    sourceElements.forEach(element => document.head.appendChild(element))\n  }, 1),\n}\n\nexport default function createHeadManager(isServer: boolean, titleCallback: ((title: string) => string), onUpdate: ((elements: string[]) => void)): ({\n  createProvider: () => ({\n    update: (elements: Array<string>) => void,\n    disconnect: () => void,\n  })\n}) {\n  const states: Record<string, Array<string>> = {}\n  let lastProviderId = 0\n\n  function connect(): string {\n    const id = (lastProviderId += 1)\n    states[id] = []\n    return id.toString()\n  }\n\n  function disconnect(id: string): void {\n    if (id === null || Object.keys(states).indexOf(id) === -1) {\n      return\n    }\n\n    delete states[id]\n    commit()\n  }\n\n  function update(id: string, elements: Array<string> = []): void {\n    if (id !== null && Object.keys(states).indexOf(id) > -1) {\n      states[id] = elements\n    }\n\n    commit()\n  }\n\n  function collect(): Array<string> {\n    const elements = Object.values(states)\n      .reduce((carry, elements) => carry.concat(elements), [])\n      .reduce((carry, element) => {\n        if (element.indexOf('<') === -1) {\n          return carry\n        }\n\n        if (element.indexOf('<title ') === 0) {\n          const title = element.match(/(<title [^>]+>)(.*?)(<\\/title>)/)\n          carry.title = title ? `${title[1]}${titleCallback(title[2])}${title[3]}`: element\n          return carry\n        }\n\n        const match = element.match(/ inertia=\"[^\"]+\"/)\n        if (match) {\n          carry[match[0]] = element\n        } else {\n          carry[Object.keys(carry).length] = element\n        }\n\n        return carry\n      }, {} as Record<string, string>)\n\n    return Object.values(elements)\n  }\n\n  function commit(): void {\n    isServer ? onUpdate(collect()) : Renderer.update(collect())\n  }\n\n  return {\n    createProvider: function () {\n      const id = connect()\n\n      return {\n        update: (elements) => update(id, elements),\n        disconnect: () => disconnect(id),\n      }\n    },\n  }\n}\n","import { Router } from './router'\n\nexport * from './types'\n\nexport { default as createHeadManager } from './head'\nexport { default as shouldIntercept } from './shouldIntercept'\nexport { hrefToUrl, mergeDataIntoQueryString, urlWithoutHash } from './url'\n\nexport const Inertia = new Router()\n","export default function shouldIntercept(event: KeyboardEvent): boolean {\n  const isLink = (event.currentTarget as HTMLElement).tagName.toLowerCase() === 'a'\n  return !(\n    (event.target && (event?.target as HTMLElement).isContentEditable) ||\n    event.defaultPrevented ||\n    (isLink && event.which > 1) ||\n    (isLink && event.altKey) ||\n    (isLink && event.ctrlKey) ||\n    (isLink && event.metaKey) ||\n    (isLink && event.shiftKey)\n  )\n}\n"],"names":["Method","modal","listener","show","html","JSON","stringify","document","createElement","page","innerHTML","querySelectorAll","forEach","a","setAttribute","this","style","position","width","height","padding","boxSizing","backgroundColor","zIndex","addEventListener","hide","iframe","borderRadius","appendChild","body","prepend","overflow","contentWindow","open","write","outerHTML","close","hideOnEscape","bind","removeEventListener","event","keyCode","fn","delay","clearTimeout","timeoutID","setTimeout","apply","_this","source","form","parentKey","Object","prototype","hasOwnProperty","call","key","append","composeKey","parent","value","Array","isArray","from","keys","index","toString","toISOString","name","objectToFormData","href","window","location","method","data","qsArrayFormat","test","hasHost","startsWith","hasAbsolutePath","includes","GET","length","url","search","qs","deepmerge","ignoreQueryPrefix","encodeValuesOnly","arrayFormat","protocol","host","pathname","hasRelativePath","substring","hasSearch","hasHash","hash","join","options","dispatchEvent","visit","detail","init","resolveComponent","swapComponent","initialPage","isBackForwardVisit","handleBackForwardVisit","isLocationVisit","handleLocationVisit","handleInitialPageVisit","setupEventListeners","setPage","preserveState","then","handlePopstateEvent","debounce","handleScrollEvent","scrollRegions","target","hasAttribute","saveScrollPositions","replaceState","map","region","top","scrollTop","left","scrollLeft","resetScrollPositions","scrollTo","getElementById","slice","scrollIntoView","restoreScrollPositions","scrollPosition","history","state","performance","getEntriesByType","type","version","preserveScroll","_this2","fireNavigateEvent","locationVisit","sessionStorage","setItem","urlWithoutHash","reload","error","getItem","parse","removeItem","rememberedState","_window$history$state2","_window$history$state4","_this3","isLocationVisitResponse","response","status","headers","isInertiaResponse","createVisitId","visitId","cancelVisit","activeVisit","cancelled","interrupted","completed","cancelToken","cancel","onCancel","fireFinishEvent","onFinish","finishVisit","resolvePreserveOption","props","errors","replace","only","errorBag","forceFormData","onCancelToken","onBefore","onStart","onProgress","onSuccess","onError","queryStringArrayFormat","hrefToUrl","values","some","hasFiles","mergeDataIntoQueryString","_data","cancelable","fireBeforeEvent","Axios","CancelToken","_this4","fireStartEvent","params","token","Accept","X-Requested-With","X-Inertia","X-Inertia-Partial-Component","component","X-Inertia-Partial-Data","X-Inertia-Error-Bag","X-Inertia-Version","onUploadProgress","progress","percentage","Math","round","loaded","total","fireProgressEvent","reject","pageResponse","_window$history$state5","requestUrl","responseUrl","fireErrorEvent","scopedErrors","locationUrl","isCancel","exception","throwException","resolve","_this5","pushState","Promise","_this6","get","console","warn","post","POST","put","PUT","patch","PATCH","DELETE","remember","isServer","_this$page","restore","_window$history$state6","_window$history$state7","on","callback","defaultPrevented","preventDefault","buildDOMElement","tag","template","content","firstChild","script","node","getAttributeNames","getAttribute","isInertiaManagedElement","element","nodeType","Node","ELEMENT_NODE","findMatchingElementIndex","elements","findIndex","update","head","childNodes","filter","targetElement","sourceElements","splice","sourceElement","isEqualNode","parentNode","replaceChild","removeChild","titleCallback","onUpdate","states","reduce","carry","concat","indexOf","match","title","collect","Renderer","createProvider","lastProviderId","id","connect","commit","disconnect","currentTarget","tagName","toLowerCase","isContentEditable","isLink","which","altKey","ctrlKey","metaKey","shiftKey"],"mappings":"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"}